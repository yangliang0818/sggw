//====================================================================================================
// [插件名称] jQuery ImgSlider
//----------------------------------------------------------------------------------------------------
//[描      述]  一个图片切换插件，可以预览，可以动态做出图片说明
//[使用方法]  生成一个DIV，包含需要幻灯演示的图片，然后用一个DIV包裹，并且用这个包裹的DIV直接调用ImgSlider方法
//			如：<div id="diva"><div class="divb">你的图片</div></div>
//简单调用：$("#diva").ImgSlider();
//[源码下载]  http://files.cnblogs.com/walkerwang/slideImg.rar
//----------------------------------------------------------------------------------------------------
// [作者网名] walkerwang
// [邮    箱] walkerwzy@gmail.com
// [作者博客] http://walkerwang.cnblogs.com
// [更新日期] 2010-06-24
// [版 本 号] ver1.0
//====================================================================================================

(function($){$.fn.ImgSlider=function(options){var options=$.extend({},$.fn.ImgSlider.defaults,options);this.each(function(){var flag=0;var objH;var m;var th;var forceIndex=-1;var indexbefore;var thisWrap=this;var bigImgWrap;var titleWrap=$("<div class=\"imgtitle\"/>");var naviWrap=$("<div class=\"smallimgs\"/>");var naviNumWrap=$("<div/>",{"class":"numNavi"});var imgCollection;var imgPrev;var numNavis;bigImgWrap=$("."+options.wrapName,this).eq(0);imgCollection=bigImgWrap.find("img");$(this).append(titleWrap).append(naviWrap);titleWrap.append("<div class='it_bg'/>").append("<div class='it_title'/>").append("<div class='it_cont'/>");var imgCount=imgCollection.size();for(var i=0;i<imgCount;i++){var imgWrap=$("<div class='imgs'/>");var imgElement=$("<img/>",{alt:'',src:imgCollection.eq(i).attr("src")});imgWrap.append(imgElement).appendTo(naviWrap);var numElement=$("<span>"+(i+1)+"</span>");numElement.appendTo(naviNumWrap);if(typeof imgCollection.eq(i).attr("cont")=="undefined")imgCollection.eq(i).attr("cont","");}imgPrev=$(".imgs",naviWrap);numNavis=$("span",naviNumWrap);if(options.hideCaptial)$(".imgtitle",this).hide();else{objH=imgCollection.eq(0);titleWrap.find(".it_title").html(objH.attr("title")).end().find(".it_cont").html(objH.attr("cont"));}if(options.hidePreview){naviWrap.hide();$(this).append(naviNumWrap);}naviWrap.css({backgroundPosition:options.arrPosition+"px 0"});$(this).css({width:options.wrapWidth,height:options.wrapHeight,border:"1px solid #ccc",position:"relative",overflow:"hidden"});bigImgWrap.css({height:options.wrapHeight,width:options.wrapWidth,overflow:"visible",whiteSpace:"nowrap",marginLeft:-options.wrapWidth});bigImgWrap.find("img").css({height:options.wrapHeight,width:options.wrapWidth,cursor:"pointer"});$(".imgtitle, .it_bg",this).css({textAlign:"center",width:"100%",position:"absolute",top:0,left:0,color:"#fff"});$(".it_bg",this).css({background:"black",filter:"alpha(opacity=40)",opacity:0.4,height:"100%"});$(".it_title",this).css({font:"800 1.5em 宋体",position:"relative",paddingTop:5});$(".it_cont",this).css({whiteSpace:"normal",textAlign:"left",position:"relative",padding:"5px 15px"});bigImgWrap.prepend(bigImgWrap.find("img:last").clone());if($.browser.msie){imgPrev.find("img").removeAttr("width").removeAttr("height");}imgPrev.eq(0).addClass("highlight_img");if(options.hidePreview)numNavis.eq(0).addClass("current");m=setInterval(imgscroll,options.interval);function imgscroll(){var i;if(forceIndex==-1){i=naviWrap.find(".imgs").index($("div.highlight_img",thisWrap));if(i==imgCollection.length-1)i=0;else i++;}else i=forceIndex;if(indexbefore+1==imgCollection.length){if(i==0)bigImgWrap.css({marginLeft:0});}bigImgWrap.animate({marginLeft:options.wrapWidth*(-i-1)},options.speed);$(".highlight_img",thisWrap).removeClass("highlight_img");var imgleft=options.arrPosition+i*70;naviWrap.animate({backgroundPosition:imgleft+"px 0"},options.speed,function(){$(".imgs",thisWrap).eq(i).addClass("highlight_img");});$(".current",naviNumWrap).removeClass("current");numNavis.eq(i).addClass("current");indexbefore=i;if(!options.hideCaptial){titleWrap.hide();objH=bigImgWrap.find("img").eq(i+1);titleWrap.find(".it_title").html(objH.attr("title")).end().find(".it_cont").html(objH.attr("cont")).end().slideDown(options.speed);}}$(".smallimgs",thisWrap).find(".imgs").live("mouseover",function(){var thisobj=$(this);th=setTimeout(function(){clearInterval(m);forceIndex=$(".smallimgs",thisWrap).find(".imgs").index(thisobj);imgscroll(i);flag=1;},300);});$(".smallimgs",thisWrap).find(".imgs").live("mouseout",function(){clearTimeout(th);if(flag==1){m=setInterval(imgscroll,options.interval);flag=0;forceIndex=-1;}});$(".numNavi",thisWrap).find("span").live("mouseover",function(){var i=numNavis.index(this);$(".smallimgs",thisWrap).find(".imgs").eq(i).trigger("mouseover");});$(".numNavi",thisWrap).find("span").live("mouseout",function(){clearTimeout(th);if(flag==1){m=setInterval(imgscroll,options.interval);flag=0;forceIndex=-1;}});});};$.fn.ImgSlider.defaults={wrapName:'imgb',wrapWidth:351,wrapHeight:396,speed:1000,interval:5000,arrPosition:-403,hidePreview:false,hideCaptial:false}})(jQuery);